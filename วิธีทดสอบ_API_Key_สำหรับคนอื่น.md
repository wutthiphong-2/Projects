# ЁЯзк р╕зр╕┤р╕Шр╕╡р╕Чр╕Фр╕кр╕нр╕Ъ API Key - р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Др╕Щр╕нр╕╖р╣Ир╕Щр╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Ыр╣Гр╕Кр╣Йр╣Др╕Фр╣Й

## ЁЯОп р╕зр╕▒р╕Хр╕Цр╕╕р╕Ыр╕гр╕░р╕кр╕Зр╕Др╣М

р╕Чр╕Фр╕кр╕нр╕Ър╕зр╣Ир╕▓ API Key р╕Чр╕╡р╣Ир╣Др╕Фр╣Йр╕Ир╕▓р╕Бр╕лр╕Щр╣Йр╕▓ API Management р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Гр╕Кр╣Йр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Ыр╣Гр╕Кр╣Йр╣Др╕Фр╣Йр╕Ир╕гр╕┤р╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И

---

## ЁЯУЛ **р╕зр╕┤р╕Шр╕╡р╕Чр╕Фр╕кр╕нр╕Ъ (р╣Бр╕Щр╕░р╕Щр╕│)**

### **р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╣Гр╕Кр╣Й Python Script (р╕Зр╣Ир╕▓р╕вр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф)**

#### р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щ:

1. **р╕кр╕гр╣Йр╕▓р╕З API Key р╕Ир╕▓р╕Бр╕лр╕Щр╣Йр╕▓ API Management:**
   - Login р╣Ар╕Вр╣Йр╕▓р╕гр╕░р╕Ър╕Ъ тЖТ `http://localhost:3000`
   - р╣Др╕Ыр╕лр╕Щр╣Йр╕▓ API Management
   - р╕Др╕ер╕┤р╕Б "р╕кр╕гр╣Йр╕▓р╕З API Key"
   - р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Бр╕ер╕░р╣Ар╕ер╕╖р╕нр╕Б Permissions
   - р╕Др╕▒р╕Фр╕ер╕нр╕Б API Key (тЪая╕П р╣Бр╕кр╕Фр╕Зр╣Бр╕Др╣Ир╕Др╕гр╕▒р╣Йр╕Зр╣Ар╕Фр╕╡р╕вр╕з!)

2. **р╣Ар╕Ыр╕┤р╕Фр╣Др╕Яр╕ер╣М `test_api_key_usage.py`**

3. **р╣Бр╕Бр╣Йр╣Др╕Вр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓:**
   ```python
   API_URL = "http://127.0.0.1:8000"  # тЖР URL р╕Вр╕нр╕З API
   API_KEY = "ak_xxxxxxxxxxxxxxxxxxx"  # тЖР р╣Гр╕кр╣И API Key р╕Чр╕╡р╣Ир╕Др╕▒р╕Фр╕ер╕нр╕Бр╕бр╕▓
   ```

4. **р╕гр╕▒р╕Щ script:**
   ```bash
   python test_api_key_usage.py
   ```

5. **р╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М:**
   - Script р╕Ир╕░р╕Чр╕Фр╕кр╕нр╕Ъ:
     - тЬЕ р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З (р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й, р╕Бр╕ер╕╕р╣Ир╕б, OU)
     - тЬЕ Permissions (р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡ permission р╕нр╕░р╣Др╕гр╕Ър╣Йр╕▓р╕З)
     - тЬЕ Rate Limit (р╕Чр╕Фр╕кр╕нр╕Ър╣Ар╕гр╕╡р╕вр╕Бр╕лр╕ер╕▓р╕вр╕Др╕гр╕▒р╣Йр╕З)
     - тЬЕ р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ (р╣Вр╕Др╣Йр╕Фр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З)

---

## ЁЯФС **р╕зр╕┤р╕Шр╕╡р╣Др╕Фр╣Й API Key**

### **р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф:**

1. **р╣Ар╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ:**
   ```
   http://localhost:3000
   ```

2. **Login:**
   - р╕Бр╕гр╕нр╕Б username р╣Бр╕ер╕░ password
   - р╕Др╕ер╕┤р╕Б "Login"

3. **р╣Др╕Ыр╕лр╕Щр╣Йр╕▓ API Management:**
   - р╕Др╕ер╕┤р╕Бр╣Ар╕бр╕Щр╕╣ "API Management" (р╣Др╕нр╕Др╕нр╕Щр╕Бр╕╕р╕Нр╣Бр╕И ЁЯФС)
   - р╕лр╕гр╕╖р╕нр╣Др╕Ыр╕Чр╕╡р╣И: `http://localhost:3000/api-management`

4. **р╕кр╕гр╣Йр╕▓р╕З API Key:**
   - р╣Др╕Ыр╕Чр╕╡р╣И Tab "API Keys"
   - р╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕б "р╕кр╕гр╣Йр╕▓р╕З API Key" (+)
   - р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е:
     ```
     р╕Кр╕╖р╣Ир╕н: Test API Key
     р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в: р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Чр╕Фр╕кр╕нр╕Ъ
     Rate Limit (р╕Хр╣Ир╕нр╕Щр╕▓р╕Чр╕╡): 60
     Rate Limit (р╕Хр╣Ир╕нр╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕З): 1000
     Permissions:
       тЬЕ users:read
       тЬЕ groups:read
       тЬЕ ous:read
       тЬЕ activity:read
     ```
   - р╕Др╕ер╕┤р╕Б "р╕кр╕гр╣Йр╕▓р╕З"

5. **р╕Др╕▒р╕Фр╕ер╕нр╕Б API Key:**
   - тЪая╕П **р╕кр╕│р╕Др╕▒р╕Н:** API Key р╣Бр╕кр╕Фр╕Зр╣Бр╕Др╣Ир╕Др╕гр╕▒р╣Йр╕Зр╣Ар╕Фр╕╡р╕вр╕з!
   - р╕Др╕ер╕┤р╕Бр╕Ыр╕╕р╣Ир╕б "Copy" (ЁЯУЛ)
   - р╣Ар╕Бр╣Зр╕Ъ API Key р╣Др╕зр╣Йр╣Гр╕Щр╕Чр╕╡р╣Ир╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в

---

## ЁЯУЭ **р╕Чр╕Фр╕кр╕нр╕Ър╕Фр╣Йр╕зр╕в Script**

### **р╕гр╕▒р╕Щ `test_api_key_usage.py`:**

```bash
python test_api_key_usage.py
```

### **р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣И Script р╕Ир╕░р╕Чр╕Фр╕кр╕нр╕Ъ:**

1. **р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З:**
   - тЬЕ р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
   - тЬЕ р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕ер╕╕р╣Ир╕б
   - тЬЕ р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е OU

2. **р╕Чр╕Фр╕кр╕нр╕Ъ Permissions:**
   - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Др╕╕р╕Ур╕бр╕╡ permission р╕нр╕░р╣Др╕гр╕Ър╣Йр╕▓р╕З:
     - `users:read` - р╕нр╣Ир╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
     - `groups:read` - р╕нр╣Ир╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕ер╕╕р╣Ир╕б
     - `ous:read` - р╕нр╣Ир╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е OU
     - `activity:read` - р╕Фр╕╣ Activity Log
     - `users:write` - р╕кр╕гр╣Йр╕▓р╕З/р╣Бр╕Бр╣Йр╣Др╕Вр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
     - `groups:write` - р╕кр╕гр╣Йр╕▓р╕З/р╣Бр╕Бр╣Йр╣Др╕Вр╕Бр╕ер╕╕р╣Ир╕б

3. **р╕Чр╕Фр╕кр╕нр╕Ъ Rate Limit:**
   - р╣Ар╕гр╕╡р╕вр╕Б API р╕лр╕ер╕▓р╕вр╕Др╕гр╕▒р╣Йр╕Зр╕Хр╕┤р╕Фр╕Хр╣Ир╕нр╕Бр╕▒р╕Щ
   - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ hit rate limit р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
   - р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е rate limit

4. **р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ:**
   - р╣Бр╕кр╕Фр╕Зр╣Вр╕Др╣Йр╕Фр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ъ:
     - Python
     - cURL
     - JavaScript
     - PHP

---

## ЁЯФН **р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З**

### **р╕Цр╣Йр╕▓р╕Чр╕Фр╕кр╕нр╕Ър╕Ьр╣Ир╕▓р╕Щ:**

```
тЬЕ р╕Чр╕╕р╕Бр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╕Ьр╣Ир╕▓р╕Щ!
ЁЯОЙ р╕Др╕╕р╕Ур╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Гр╕Кр╣Й API Key р╕Щр╕╡р╣Йр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Ыр╣Гр╕Кр╣Йр╣Др╕Фр╣Й!
```

### **р╕Цр╣Йр╕▓р╕бр╕╡ Error:**

#### **Error 401 (Unauthorized):**
- API Key р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- API Key р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕
- API Key р╕Цр╕╣р╕Б deactivate

#### **Error 403 (Forbidden):**
- API Key р╣Др╕бр╣Ир╕бр╕╡ permission р╕кр╕│р╕лр╕гр╕▒р╕Ъ endpoint р╕Щр╕▒р╣Йр╕Щ
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Ар╕ер╕╖р╕нр╕Б Permissions р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И

#### **Error 429 (Too Many Requests):**
- р╣Ар╕Бр╕┤р╕Щ rate limit р╣Бр╕ер╣Йр╕з
- р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣Ир╣Бр╕ер╣Йр╕зр╕ер╕нр╕Зр╣Гр╕лр╕бр╣И
- р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ rate limit р╕Чр╕╡р╣Ир╕Хр╕▒р╣Йр╕Зр╣Др╕зр╣Й

---

## ЁЯТб **р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ир╕гр╕┤р╕З**

### **Python:**

```python
import requests

API_URL = "http://127.0.0.1:8000"
API_KEY = "ak_xxxxxxxxxxxxxxxxxxx"

headers = {"X-API-Key": API_KEY}

# р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
response = requests.get(f"{API_URL}/api/users/", headers=headers)
users = response.json()
print(f"р╕Юр╕Ъ {len(users)} р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й")

# р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕ер╕╕р╣Ир╕б
response = requests.get(f"{API_URL}/api/groups/", headers=headers)
groups = response.json()
print(f"р╕Юр╕Ъ {len(groups)} р╕Бр╕ер╕╕р╣Ир╕б")
```

### **cURL:**

```bash
# р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
curl -X GET "http://127.0.0.1:8000/api/users/" \
  -H "X-API-Key: ak_xxxxxxxxxxxxxxxxxxx"

# р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Бр╕ер╕╕р╣Ир╕б
curl -X GET "http://127.0.0.1:8000/api/groups/" \
  -H "X-API-Key: ak_xxxxxxxxxxxxxxxxxxx"
```

### **JavaScript:**

```javascript
const API_URL = "http://127.0.0.1:8000";
const API_KEY = "ak_xxxxxxxxxxxxxxxxxxx";

// р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
fetch(`${API_URL}/api/users/`, {
  headers: {
    'X-API-Key': API_KEY
  }
})
.then(res => res.json())
.then(users => {
  console.log(`р╕Юр╕Ъ ${users.length} р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й`);
});
```

---

## тЬЕ **Checklist р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ**

- [ ] р╕кр╕гр╣Йр╕▓р╕З API Key р╕Ир╕▓р╕Бр╕лр╕Щр╣Йр╕▓ API Management
- [ ] р╕Др╕▒р╕Фр╕ер╕нр╕Б API Key
- [ ] р╣Гр╕кр╣И API Key р╣Гр╕Щ `test_api_key_usage.py`
- [ ] р╕гр╕▒р╕Щ script: `python test_api_key_usage.py`
- [ ] р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Чр╕╕р╕Бр╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╕Ьр╣Ир╕▓р╕Щ
- [ ] р╕Чр╕Фр╕кр╕нр╕Ъ Permissions (р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕бр╕╡ permission р╕нр╕░р╣Др╕гр╕Ър╣Йр╕▓р╕З)
- [ ] р╕Чр╕Фр╕кр╕нр╕Ъ Rate Limit (р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ rate limit р╕Чр╕│р╕Зр╕▓р╕Щ)
- [ ] р╕Чр╕Фр╕кр╕нр╕Ър╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕гр╕┤р╕З (р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й, р╕Бр╕ер╕╕р╣Ир╕б, OU)

---

## ЁЯОп **р╕кр╕гр╕╕р╕Ы**

**р╕Цр╣Йр╕▓р╕Чр╕Фр╕кр╕нр╕Ър╕Ьр╣Ир╕▓р╕Щ тЖТ р╕Др╕Щр╕нр╕╖р╣Ир╕Щр╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Гр╕Кр╣Й API Key р╕Щр╕╡р╣Йр╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Ыр╣Гр╕Кр╣Йр╣Др╕Фр╣Й!**

**р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕бр╕╡:**
1. тЬЕ API Key (р╕Ир╕▓р╕Бр╕лр╕Щр╣Йр╕▓ API Management)
2. тЬЕ API URL (р╣Ар╕Кр╣Ир╕Щ `http://127.0.0.1:8000`)
3. тЬЕ Permissions р╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б (р╣Ар╕ер╕╖р╕нр╕Бр╕Хр╕нр╕Щр╕кр╕гр╣Йр╕▓р╕З API Key)

**р╕зр╕┤р╕Шр╕╡р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ:**
- р╣Гр╕кр╣И API Key р╣Гр╕Щ header: `X-API-Key`
- р╣Ар╕гр╕╡р╕вр╕Б API endpoints р╕Хр╕▓р╕б permissions р╕Чр╕╡р╣Ир╕бр╕╡
- р╕гр╕░р╕зр╕▒р╕З rate limit

---

## ЁЯЪи **р╕Вр╣Йр╕нр╕Др╕зр╕гр╕гр╕░р╕зр╕▒р╕З**

1. **р╕нр╕вр╣Ир╕▓р╣Бр╕Кр╕гр╣М API Key р╕Бр╕▒р╕Ър╕Др╕Щр╕нр╕╖р╣Ир╕Щ** - API Key р╕Др╕╖р╕нр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
2. **р╣Ар╕Бр╣Зр╕Ъ API Key р╣Гр╕Щр╕Чр╕╡р╣Ир╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в** - р╣Гр╕Кр╣Й Environment Variables
3. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Permissions** - р╕нр╕вр╣Ир╕▓р╣Гр╕лр╣Й permission р╕бр╕▓р╕Бр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы
4. **р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Rate Limit** - р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Гр╕лр╣Йр╣Ар╕лр╕бр╕▓р╕░р╕кр╕б
5. **р╕лр╕бр╕▒р╣Ир╕Щр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Activity Log** - р╕Фр╕╣р╕зр╣Ир╕▓р╕бр╕╡р╕Бр╕▓р╕гр╣Гр╕Кр╣Й API Key р╣Бр╕Ър╕Ър╕Ьр╕┤р╕Фр╕Ыр╕Бр╕Хр╕┤р╕лр╕гр╕╖р╕нр╣Др╕бр╣И

---

## ЁЯУЮ **р╕Цр╣Йр╕▓р╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓**

1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Backend Server р╕Чр╕│р╕Зр╕▓р╕Щр╕нр╕вр╕╣р╣И:
   ```bash
   python check_backend.py
   ```

2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ API Key р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З:
   - р╣Ар╕Ыр╕┤р╕Фр╕лр╕Щр╣Йр╕▓ API Management
   - р╕Фр╕╣р╕гр╕▓р╕вр╕Бр╕▓р╕г API Keys
   - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕вр╕▒р╕З Active р╕нр╕вр╕╣р╣Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣И

3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Permissions:
   - р╕Фр╕╣р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф API Key
   - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Ар╕ер╕╖р╕нр╕Б Permissions р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И

---

**р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ!** ЁЯОЙ

